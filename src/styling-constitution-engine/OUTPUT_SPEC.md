# üìú Output Specification v0.1

**Styling Constitution Engine (SCE)**

---

## 1Ô∏è‚É£ Output Overview

### Tujuan

Output layer bertanggung jawab untuk:

1. **Generate CSS** - Buat CSS dari kontrak
2. **Atomic Classes** - Setiap kontrak = satu class CSS
3. **Deterministic** - Input sama ‚Üí output sama selalu
4. **Stateless** - Tidak ada state di CSS
5. **Predictable** - Output mudah diprediksi

---

## 2Ô∏è‚É£ CSS Output Format

### File Structure

```css
/* Generated by Styling Constitution Engine */
/* Version: v0.1 */
/* Constitution: v0.1 */

:root {
  /* CSS Variables */
  --bg-primary: #e11d48;
  --text-surface: #f8fafc;
  --px-md: 1rem;
  --py-sm: 0.75rem;
  --rounded-md: 0.5rem;
}

/* Atomic Classes */
.bg-primary {
  background-color: var(--bg-primary);
}

.text-surface {
  color: var(--text-surface);
}

.px-md {
  padding-inline: var(--px-md);
}

.py-sm {
  padding-block: var(--py-sm);
}

.rounded-md {
  border-radius: var(--rounded-md);
}
```

### Output Rules

1. **Atomic**
   - Setiap class = satu properti CSS
   - Tidak ada shorthand properties

2. **Variable-Based**
   - Semua nilai menggunakan CSS variables
   - Tidak ada hardcoded values

3. **Deterministic**
   - Urutan class konsisten
   - Tidak ada conditional CSS

4. **Minimal**
   - Hanya class yang digunakan
   - Tidak ada unused CSS

---

## 3Ô∏è‚É£ Class Generation

### Contract ‚Üí CSS Mapping

| Contract | CSS Output | Variable |
| -------- | ---------- | -------- |
| `bg-primary` | `.bg-primary { background-color: var(--bg-primary); }` | `--bg-primary` |
| `text-surface` | `.text-surface { color: var(--text-surface); }` | `--text-surface` |
| `px-md` | `.px-md { padding-inline: var(--px-md); }` | `--px-md` |
| `py-sm` | `.py-sm { padding-block: var(--py-sm); }` | `--py-sm` |
| `rounded-md` | `.rounded-md { border-radius: var(--rounded-md); }` | `--rounded-md` |

### Property Mapping

```typescript
const propertyMap: Record<string, string> = {
  'bg': 'background-color',
  'text': 'color',
  'px': 'padding-inline',
  'py': 'padding-block',
  'rounded': 'border-radius',
  'shadow': 'box-shadow',
  'border': 'border-color',
  'border-width': 'border-width',
};
```

---

## 4Ô∏è‚É£ CSS Variables

### Variable Naming

```
--<property>-<token>
```

Contoh:
- `--bg-primary`
- `--text-surface`
- `--px-md`
- `--rounded-md`

### Variable Scope

```css
:root {
  /* Global scope */
  --bg-primary: #e11d48;
}

/* Tidak ada local scope */
/* Semua variables global */
```

### Variable Values

**Dari Constitution**:
```css
--bg-primary: #e11d48; /* Langsung dari constitution */
```

**Computed Values** (Tidak didukung v0.1):
```css
--bg-primary-hover: #c026d3; /* Tidak didukung */
```

---

## 5Ô∏è‚É£ Output Optimization

### Minification

```typescript
function minifyCSS(css: string): string {
  return css
    .replace(/\/\*[\s\S]*?\*\//g, '') // Remove comments
    .replace(/\s+/g, ' ') // Collapse whitespace
    .replace(/\n\s*\n/g, '\n') // Remove empty lines
    .trim();
}
```

### Deduplication

```typescript
function deduplicateClasses(classes: string[]): string[] {
  return Array.from(new Set(classes));
}
```

### Tree Shaking

```typescript
function treeShakeCSS(css: string, usedContracts: string[]): string {
  const usedClasses = new Set(usedContracts);
  
  return css
    .split('\n')
    .filter(line => {
      const className = line.match(/^\.([\w-]+)/)?.[1];
      return !className || usedClasses.has(className);
    })
    .join('\n');
}
```

---

## 6Ô∏è‚É£ Output Formats

### CSS File

```css
/* Generated by Styling Constitution Engine */
/* Version: v0.1 */

:root {
  --bg-primary: #e11d48;
  --text-surface: #f8fafc;
}

.bg-primary {
  background-color: var(--bg-primary);
}

.text-surface {
  color: var(--text-surface);
}
```

### JSON Output (Opsional)

```json
{
  "version": "0.1",
  "constitution": "0.1",
  "variables": {
    "bg-primary": "#e11d48",
    "text-surface": "#f8fafc"
  },
  "classes": {
    "bg-primary": "background-color: var(--bg-primary);",
    "text-surface": "color: var(--text-surface);"
  }
}
```

### TypeScript Types (Opsional)

```typescript
export interface GeneratedCSS {
  variables: Record<string, string>;
  classes: Record<string, string>;
}

export const generatedCSS: GeneratedCSS = {
  variables: {
    'bg-primary': '#e11d48',
    'text-surface': '#f8fafc'
  },
  classes: {
    'bg-primary': 'background-color: var(--bg-primary);',
    'text-surface': 'color: var(--text-surface);'
  }
};
```

---

## 7Ô∏è‚É£ Output Validation

### CSS Syntax Validation

```typescript
function validateCSS(css: string): ValidationResult {
  // Check for syntax errors
  const hasSyntaxErrors = /[^}]*{[^}]*}/.test(css);
  
  if (hasSyntaxErrors) {
    return {
      valid: false,
      error: "CSS_SYNTAX_ERROR",
      message: "CSS syntax error detected"
    };
  }
  
  return { valid: true };
}
```

### Variable Validation

```typescript
function validateVariables(css: string, constitution: Constitution): ValidationResult {
  const usedVars = extractUsedVariables(css);
  const definedVars = extractDefinedVariables(css);
  
  const undefinedVars = usedVars.filter(v => !definedVars.includes(v));
  
  if (undefinedVars.length > 0) {
    return {
      valid: false,
      error: "UNDEFINED_VARIABLE",
      message: `Variables used but not defined: ${undefinedVars.join(', ')}`
    };
  }
  
  return { valid: true };
}
```

---

## 8Ô∏è‚É£ Output Metrics

### Size Metrics

| Metric | Target | Actual |
| ------ | ------ | ------ |
| File Size | < 50KB | TBD |
| Gzipped Size | < 10KB | TBD |
| Class Count | < 1000 | TBD |

### Performance Metrics

| Metric | Target | Actual |
| ------ | ------ | ------ |
| Parse Time | < 10ms | TBD |
| Generate Time | < 50ms | TBD |
| Total Time | < 100ms | TBD |

---

## 9Ô∏è‚É£ Output Examples

### Simple Output

**Input**:
```html
<div class="bg-primary text-surface">
```

**Output**:
```css
:root {
  --bg-primary: #e11d48;
  --text-surface: #f8fafc;
}

.bg-primary {
  background-color: var(--bg-primary);
}

.text-surface {
  color: var(--text-surface);
}
```

### Complex Output

**Input**:
```html
<div class="bg-primary text-surface px-md py-sm rounded-md shadow-md">
```

**Output**:
```css
:root {
  --bg-primary: #e11d48;
  --text-surface: #f8fafc;
  --px-md: 1rem;
  --py-sm: 0.75rem;
  --rounded-md: 0.5rem;
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
}

.bg-primary {
  background-color: var(--bg-primary);
}

.text-surface {
  color: var(--text-surface);
}

.px-md {
  padding-inline: var(--px-md);
}

.py-sm {
  padding-block: var(--py-sm);
}

.rounded-md {
  border-radius: var(--rounded-md);
}

.shadow-md {
  box-shadow: var(--shadow-md);
}
```

---

## üîí Non-Goals v0.1

* Source maps (v0.2+)
* PostCSS plugins (v0.2+)
* CSS-in-JS (v0.2+)
* Dynamic imports (v0.2+)
* Hot module replacement (v0.2+)

‚û°Ô∏è Semua itu **roadmap masa depan**

---

## ‚úÖ Checklist

Sebelum menghasilkan output:

- [x] CSS format jelas
- [x] Variable naming konsisten
- [x] Class generation atomic
- [x] Output deterministic
- [x] Optimization terimplementasi
- [x] Validation terimplementasi
- [x] Metrics terdefinisi

---

**Versi**: v0.1
**Status**: Production Ready